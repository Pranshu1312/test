<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyayal AI - Document Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300..700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #000000;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(120, 81, 169, 0.3), transparent 30%),
                radial-gradient(circle at 85% 30%, rgba(0, 128, 128, 0.3), transparent 40%),
                radial-gradient(circle at 50% 80%, rgba(255, 192, 203, 0.2), transparent 40%);
            background-attachment: fixed;
            overflow-x: hidden;
        }

        .font-teko { font-family: 'Teko', sans-serif; }

        .glass-card {
            background: rgba(10, 10, 20, 0.6);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            position: relative;
            z-index: 10;
        }

        .input-glass {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .input-glass:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(167, 139, 250, 0.8);
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.3);
            outline: none;
        }

        .btn-glow {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .btn-glow:hover {
            box-shadow: 0 0 25px rgba(167, 139, 250, 0.6), 0 0 50px rgba(167, 139, 250, 0.4);
            transform: translateY(-2px);
        }
        
        /* Custom scrollbar for a better look */
        textarea::-webkit-scrollbar, pre::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track, pre::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb, pre::-webkit-scrollbar-thumb {
            background: rgba(167, 139, 250, 0.6);
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover, pre::-webkit-scrollbar-thumb:hover {
            background: rgba(167, 139, 250, 0.8);
        }

        /* Loading Spinner */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #A78BFA;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="text-gray-200">

    <!-- Header -->
    <header class="py-6 px-4 md:px-8 flex justify-between items-center glass-card mx-4 md:mx-8 my-4">
        <div class="flex items-center space-x-4">
            <svg class="w-12 h-12 text-violet-400" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 7L12 12M12 22V12M22 7L12 12M17 4.5L7 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="font-teko text-4xl font-bold text-white uppercase tracking-wider">Nyayal AI</h1>
        </div>
        <nav>
            <a href="index.html" class="text-lg text-gray-300 hover:text-violet-400 transition-colors duration-300">Home</a>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
            
            <!-- Input Form Card -->
            <div class="glass-card p-8">
                <h2 class="font-teko text-5xl text-white uppercase tracking-wider mb-6">Generate Your Document</h2>
                <form id="document-form">
                    <div class="space-y-6">
                        <!-- Document Type -->
                        <div>
                            <label for="document_type" class="block text-sm font-medium text-gray-400 mb-2">Document Type</label>
                            <select id="document_type" name="document_type" class="w-full p-3 input-glass text-white">
                                <option value="Non-Disclosure Agreement">Non-Disclosure Agreement (NDA)</option>
                                <option value="Memorandum of Understanding">Memorandum of Understanding (MoU)</option>
                                <!-- Add other document types here -->
                            </select>
                        </div>
                        
                        <!-- Dynamic Fields Container -->
                        <div id="dynamic-fields" class="space-y-4">
                            <!-- Fields will be added here by JS -->
                        </div>
                        
                        <button type="button" id="add-field-btn" class="w-full text-violet-300 border border-violet-500 rounded-lg py-2 hover:bg-violet-900/50 transition">
                            + Add Custom Field
                        </button>
                    </div>

                    <div class="mt-8">
                        <button type="submit" id="generate-btn" class="w-full btn-glow bg-gradient-to-r from-violet-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl text-lg uppercase tracking-widest flex items-center justify-center">
                            <span id="btn-text">Generate</span>
                            <div id="btn-loader" class="loader hidden"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Output Card -->
            <div class="glass-card p-8 sticky top-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-teko text-5xl text-white uppercase tracking-wider">Generated Document</h2>
                    <button id="copy-btn" title="Copy to Clipboard" class="p-2 rounded-lg hover:bg-violet-900/50 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                    </button>
                </div>
                <div id="output-container" class="bg-black/30 p-4 rounded-lg h-96 overflow-y-auto border border-gray-700">
                    <pre id="output-text" class="whitespace-pre-wrap text-gray-300 text-sm leading-relaxed"></pre>
                    <div id="placeholder" class="flex items-center justify-center h-full text-gray-500">
                        Your generated document will appear here...
                    </div>
                </div>
                 <div id="message-box" class="mt-4 text-center text-sm"></div>
            </div>

        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('document-form');
    const generateBtn = document.getElementById('generate-btn');
    const btnText = document.getElementById('btn-text');
    const btnLoader = document.getElementById('btn-loader');
    const outputText = document.getElementById('output-text');
    const outputContainer = document.getElementById('output-container');
    const placeholder = document.getElementById('placeholder');
    const copyBtn = document.getElementById('copy-btn');
    const messageBox = document.getElementById('message-box');
    const dynamicFieldsContainer = document.getElementById('dynamic-fields');
    const addFieldBtn = document.getElementById('add-field-btn');

    // Default fields for an NDA
    const defaultFields = [
        { name: 'disclosing_party_name', label: 'Disclosing Party Name', type: 'text', value: 'Innovate Corp' },
        { name: 'receiving_party_name', label: 'Receiving Party Name', type: 'text', value: 'Builder LLC' },
        { name: 'effective_date', label: 'Effective Date', type: 'date', value: new Date().toISOString().split('T')[0] },
        { name: 'term', label: 'Term (e.g., 5 years)', type: 'text', value: '5 years' }
    ];

    // --- THIS IS THE CORRECTED LINE ---
    // This now points to your live backend URL.
    const backendUrl = 'https://gdg-hackathon-test.onrender.com/generate-document';

    // For local testing, you can comment out the line above and use this one:
    // const backendUrl = 'http://127.0.0.1:5000/generate-document';


    function createField(field) {
        const div = document.createElement('div');
        const label = document.createElement('label');
        label.setAttribute('for', field.name);
        label.className = 'block text-sm font-medium text-gray-400 mb-2';
        label.textContent = field.label;

        const input = document.createElement('input');
        input.type = field.type;
        input.id = field.name;
        input.name = field.name;
        input.className = 'w-full p-3 input-glass text-white';
        if(field.value) input.value = field.value;
        
        div.appendChild(label);
        div.appendChild(input);
        return div;
    }
    
    function renderDefaultFields() {
        dynamicFieldsContainer.innerHTML = '';
        defaultFields.forEach(field => {
            dynamicFieldsContainer.appendChild(createField(field));
        });
    }

    addFieldBtn.addEventListener('click', () => {
        const fieldCount = dynamicFieldsContainer.children.length;
        const newField = {
            name: `custom_field_${fieldCount + 1}`,
            label: `Custom Field ${fieldCount + 1}`,
            type: 'text'
        };
        dynamicFieldsContainer.appendChild(createField(newField));
    });

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        // Show loading state
        btnText.classList.add('hidden');
        btnLoader.classList.remove('hidden');
        generateBtn.disabled = true;
        
        // Clear previous output and messages
        outputText.textContent = '';
        placeholder.style.display = 'flex';
        copyBtn.disabled = true;
        displayMessage('');

        // Collect form data into a JSON object
        const formData = new FormData(form);
        const data = {};
        for (let [key, value] of formData.entries()) {
            if (value) { // Only include fields with a value
                data[key] = value;
            }
        }

        try {
            // Use the backendUrl variable in the fetch call
            const response = await fetch(backendUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
            }

            const result = await response.json();

            if (result.generated_document) {
                outputText.textContent = result.generated_document;
                placeholder.style.display = 'none';
                copyBtn.disabled = false;
            } else {
                 throw new Error("Received an empty response from the server.");
            }

        } catch (error) {
            console.error('Error:', error);
            outputText.textContent = `An error occurred. Please check the console and make sure your backend server is running correctly.\n\nError: ${error.message}`;
            placeholder.style.display = 'none';
        } finally {
            // Hide loading state
            btnText.classList.remove('hidden');
            btnLoader.classList.add('hidden');
            generateBtn.disabled = false;
        }
    });

    copyBtn.addEventListener('click', () => {
        const textToCopy = outputText.textContent;
        if (!textToCopy) return;
        
        // A method that works in secure contexts (like iframes)
        const textArea = document.createElement("textarea");
        textArea.value = textToCopy;
        textArea.style.position = "fixed"; // Avoid scrolling to bottom
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            displayMessage('Copied to clipboard!', 'success');
        } catch (err) {
            displayMessage('Failed to copy!', 'error');
        }
        document.body.removeChild(textArea);
    });

    function displayMessage(message, type = 'info') {
        messageBox.textContent = message;
        if (type === 'success') {
            messageBox.className = 'mt-4 text-center text-sm text-green-400';
        } else if (type === 'error') {
            messageBox.className = 'mt-4 text-center text-sm text-red-400';
        } else {
            messageBox.className = 'mt-4 text-center text-sm text-gray-400';
        }
    }
    
    // Initialize with default fields
    renderDefaultFields();
});
</script>

</body>
</html>

